<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .song-list {
            list-style: none;
            padding: 0;
        }

        .song-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
            transition: all 0.3s ease;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .song-item:hover {
            background-color: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .song-info {
            flex-grow: 1;
        }

        .song-title {
            font-weight: bold;
            font-size: 18px;
            color: #333;
            margin-bottom: 5px;
        }

        .song-artist {
            color: #666;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .song-album {
            color: #888;
            font-size: 12px;
            font-style: italic;
        }

        .song-duration {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
        }

        .play-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            min-width: 120px;
        }

        .play-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .play-button.playing {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .currently-playing {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-left: 5px solid #667eea;
        }

        .audio-player {
            width: 100%;
            margin-top: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        .error {
            color: #dc3545;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üéµ –ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</h1>

    <div id="loadingMessage" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Å–µ–Ω...</div>
    <div id="errorMessage" class="error" style="display: none;"></div>

    <ul class="song-list" id="songList" style="display: none;">
        <!-- –°–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∑–¥–µ—Å—å -->
    </ul>
</div>

<script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º
    let currentAudio = null;
    let currentButton = null;
    let currentSongId = null;

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–µ—Å–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        loadSongs();
    });

    async function loadSongs() {
        try {
            const response = await fetch('/api/v1/audio/songs');

            if (!response.ok) {
                throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }

            const songs = await response.json();

            const songList = document.getElementById('songList');
            const loadingMessage = document.getElementById('loadingMessage');
            const errorMessage = document.getElementById('errorMessage');

            // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –æ—à–∏–±–∫–∏
            loadingMessage.style.display = 'none';
            errorMessage.style.display = 'none';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω
            songList.style.display = 'block';
            songList.innerHTML = '';

            songs.forEach(song => {
                const songItem = document.createElement('li');
                songItem.className = 'song-item';
                songItem.id = `song-${song.id}`;

                songItem.innerHTML = `
                        <div class="song-info">
                            <div class="song-title">${escapeHtml(song.title)}</div>
                            <div class="song-artist">üé§ ${escapeHtml(song.artist)}</div>
                            ${song.album ? `<div class="song-album">üíø ${escapeHtml(song.album)}</div>` : ''}
                            ${song.duration ? `<div class="song-duration">‚è± ${song.duration}</div>` : ''}
                        </div>
                        <button class="play-button" onclick="togglePlay(${song.id}, this)">
                            ‚ñ∂ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
                        </button>
                        <audio class="audio-player" id="audio-${song.id}" controls style="display: none;">
                            <source src="${song.fileUrl}" type="audio/mpeg">
                            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã.
                        </audio>
                    `;

                songList.appendChild(songItem);
            });
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Å–µ–Ω:', error);
            showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
        }
    }

    function togglePlay(songId, button) {
        const audio = document.getElementById(`audio-${songId}`);
        const songItem = document.getElementById(`song-${songId}`);

        // –ï—Å–ª–∏ —É–∂–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —ç—Ç–∞ –∂–µ –ø–µ—Å–Ω—è
        if (currentSongId === songId && !audio.paused) {
            audio.pause();
            button.textContent = '‚ñ∂ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏';
            button.classList.remove('playing');
            songItem.classList.remove('currently-playing');
            audio.style.display = 'none';
            currentAudio = null;
            currentButton = null;
            currentSongId = null;
            return;
        }

        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
        if (currentAudio && currentAudio !== audio) {
            currentAudio.pause();
            currentAudio.currentTime = 0;
            currentAudio.style.display = 'none';
            if (currentButton) {
                currentButton.textContent = '‚ñ∂ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏';
                currentButton.classList.remove('playing');
                document.getElementById(`song-${currentSongId}`).classList.remove('currently-playing');
            }
        }

        // –ù–∞—á–∏–Ω–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
        audio.style.display = 'block';
        audio.play().catch(error => {
            console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
            showError('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª.');
            audio.style.display = 'none';
        });

        button.textContent = '‚è∏ –ü–∞—É–∑–∞';
        button.classList.add('playing');
        songItem.classList.add('currently-playing');

        currentAudio = audio;
        currentButton = button;
        currentSongId = songId;

        // –°–æ–±—ã—Ç–∏–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        audio.onended = function() {
            button.textContent = '‚ñ∂ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏';
            button.classList.remove('playing');
            songItem.classList.remove('currently-playing');
            audio.style.display = 'none';
            currentAudio = null;
            currentButton = null;
            currentSongId = null;
        };

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        audio.onerror = function() {
            showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞');
            audio.style.display = 'none';
            button.textContent = '‚ñ∂ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏';
            button.classList.remove('playing');
            songItem.classList.remove('currently-playing');
        };
    }

    function showError(message) {
        const errorMessage = document.getElementById('errorMessage');
        const loadingMessage = document.getElementById('loadingMessage');
        const songList = document.getElementById('songList');

        loadingMessage.style.display = 'none';
        songList.style.display = 'none';
        errorMessage.style.display = 'block';
        errorMessage.textContent = message;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è HTML
    function escapeHtml(unsafe) {
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }
</script>
</body>
</html>